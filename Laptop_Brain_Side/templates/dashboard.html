<!DOCTYPE html>
<html>
<head>
    <title>VIPER - MISSION CONTROL</title>
    <style>
        :root { --acc: #ff9f1c; --bg: #0d1117; --pnl: #161b22; --brd: #30363d; --txt: #c9d1d9; }
        body { background: var(--bg); color: var(--txt); font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; }
        .nav { background: var(--pnl); padding: 12px 25px; border-bottom: 2px solid var(--acc); display: flex; justify-content: space-between; font-weight: bold; letter-spacing: 1px; }
        .layout { display: flex; height: calc(100vh - 60px); padding: 10px; gap: 10px; }
        .viewport { flex: 3; background: #000; border: 1px solid var(--brd); border-radius: 8px; position: relative; }
        #feed { width: 100%; height: 100%; object-fit: contain; }
        .sidebar { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .card { background: var(--pnl); border: 1px solid var(--brd); border-radius: 8px; padding: 15px; }
        .btn { width: 100%; padding: 12px; background: transparent; border: 1px solid var(--acc); color: var(--acc); border-radius: 4px; cursor: pointer; margin-bottom: 8px; font-weight: bold; font-size: 0.85em; }
        .btn:hover { background: var(--acc); color: var(--bg); }
        .active { background: #f85149; border-color: #f85149; color: #fff; box-shadow: 0 0 10px #f85149; }
    </style>
</head>
<body>
    <div class="nav"><span>VIPER NDT CONTROL</span><span id="conn" style="color:#f85149">● LINK PENDING</span></div>
    <div class="layout">
        <div class="viewport">
            <img src="/video_feed" id="feed">
            <div style="position:absolute; bottom:20px; left:50%; transform:translateX(-50%); display:flex; gap:10px; width: 90%;">
                <button id="aiBtn" class="btn" onclick="toggleAI()">AI SCANNER</button>
                <button class="btn" style="border-color:#8b949e; color:#8b949e;" onclick="alert('GAS SENSOR: Hardware module not detected in current configuration.')">GAS CHECK</button>
                <button class="btn" style="border-color:#8b949e; color:#8b949e;" onclick="alert('THERMAL SENSOR: Sensor hardware missing; proceeding with Visual NDT only.')">THERMAL CHECK</button>
                <button class="btn" onclick="location.href='/admin_portal'">ANALYTICS</button>
            </div>
        </div>
        <div class="sidebar">
            <div class="card">
                <div style="font-size:0.7em; color:var(--acc); margin-bottom:8px">PI TELEMETRY</div>
                <div style="font-size:0.9em">T: <span id="tmp" style="color:#58a6ff">--</span> | V: <span id="vlt" style="color:#58a6ff">--</span></div>
            </div>
            <div id="logBox" class="card" style="flex-grow:1; overflow-y:auto; font-family:monospace; font-size:0.8em; line-height:1.4;"></div>
        </div>
    </div>
    <script>
        function toggleAI() { fetch('/toggle_ai').then(r=>r.json()).then(d=>{
            const b = document.getElementById('aiBtn');
            b.innerText = d.status === "AI Active" ? "STOP SCANNER" : "AI SCANNER";
            b.className = d.status === "AI Active" ? "btn active" : "btn";
        });}
        setInterval(() => {
            fetch('/get_logs').then(r=>r.json()).then(d => {
                document.getElementById('tmp').innerText = d.health.temp || "--";
                document.getElementById('vlt').innerText = d.health.voltage || "--";
                document.getElementById('logBox').innerHTML = d.logs.map(l=>`<div style="margin-bottom:4px; padding-left:5px; border-left:2px solid ${l.includes('SNAP')?'#f85149':'#30363d'}">${l}</div>`).join('');
                document.getElementById('logBox').scrollTop = 9999;
                document.getElementById('conn').style.color = d.health.voltage === "OFFLINE" ? "#f85149" : "#3fb950";
                document.getElementById('conn').innerText = d.health.voltage === "OFFLINE" ? "● DISCONNECTED" : "● LINK ACTIVE";
            });
        }, 1000);
    </script>
</body>
</html>